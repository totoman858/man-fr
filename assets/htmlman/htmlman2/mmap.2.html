Content-type: text/html

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Man page of MMAP</TITLE>
</HEAD><BODY>
<H1>MMAP</H1>
Section: Manuel du programmeur Linux (2)<BR>Updated: 30 juillet 2003<BR><A HREF="#index">Index</A>
<A HREF="/cgi-bin/man/man2html">Return to Main Contents</A><HR>

<A NAME="lbAB">&nbsp;</A>
<H2>NOM</H2>

mmap, munmap - Établir / supprimer une projection en mémoire (map / unmap) des fichiers ou des périphériques.
<A NAME="lbAC">&nbsp;</A>
<H2>SYNOPSIS</H2>

<B>#include &lt;<A HREF="file:///usr/include/sys/mman.h">sys/mman.h</A>&gt;</B>

<P>
<B>#ifdef _POSIX_MAPPED_FILES</B>

<P>
<B>void * mmap(void *</B><I>start</I><B>, size_t </B><I>length</I><B>, int </B><I>prot</I>

<B>, int </B><I>flags</I><B>, int </B><I>fd</I><B>, off_t </B><I>offset</I><B>);</B>

<P>
<B>int munmap(void *</B><I>start</I><B>, size_t </B><I>length</I><B>);</B>

<P>
<B>#endif</B>

<A NAME="lbAD">&nbsp;</A>
<H2>DESCRIPTION</H2>

La fonction
<B>mmap</B>

demande la projection en mémoire de
<I>length</I>

octets commençant à la position
<I>offset</I>

depuis un fichier (ou un autre objet) indiqué par le descripteur
<I>fd,</I>

de préférence à l'adresse pointée par
<I>start.</I>

Cette adresse n'est qu'une préférence, généralement 0.
La véritable adresse où l'objet est projeté est renvoyée par la
fonction
<B>mmap</B>,

et n'est jamais nulle.
<P>

L'argument
<I>prot</I>

indique la protection que l'on désire pour cette zone de mémoire, et ne
doit pas entrer en conflit avec le mode d'ouverture du fichier.
Il s'agit soit de
<B>PROT_NONE</B>

(le contenu de la mémoire est inaccessible) soit d'un OU binaire entre
les constantes suivantes&nbsp;:
<DL COMPACT>
<DT><B>PROT_EXEC</B>

<DD>
On peut exécuter du code dans la zone mémoire.
<DT><B>PROT_READ</B>

<DD>
On peut lire le contenu de la zone mémoire
<DT><B>PROT_WRITE</B>

<DD>
On peut écrire dans la zone mémoire.
<DT><B>PROT_NONE</B>

<DD>
Les pages ne peuvent pas être accédées.
</DL>
<P>

Le paramètre
<I>flags</I>

indique le type de fichier projeté, les options de projection, et si
les modifications faites sur la portion projetée sont privées ou doivent
être partagées avec les autres références. Les options sont :
<DL COMPACT>
<DT><B>MAP_FIXED</B>

<DD>
N'utiliser que l'adresse indiquée. Si c'est impossible,
<B>mmap</B>

échouera. Si MAP_FIXED est spécifié
<I>start</I>

doit être un multiple de la longueur de page. Il est déconseillé d'utiliser
cette option.
<DT><B>MAP_SHARED</B>

<DD>
Partager la projection avec tout autre processus utilisant l'objet.
L'écriture dans la zone est équivalente à une écriture dans le fichier. En revanche
ce dernier n'est pas nécessairement mis à jour tant qu'on n'a pas appelé
<B><A HREF="/cgi-bin/man/man2html?2+msync">msync</A></B>(2)

ou
<B><A HREF="/cgi-bin/man/man2html?2+munmap">munmap</A></B>(2).

<DT><B>MAP_PRIVATE</B>

<DD>
Créer une projection privée, utilisant la méthode de copie à l'écriture.
L'écriture dans la zone ne modifie pas le fichier. Il n'est pas précisé
si les changements effectués dans le fichier après l'appel
<B>mmap</B>

seront visibles.
</DL>
<P>

Vous devez indiquer soit MAP_SHARED, soit MAP_PRIVATE.
<P>

Les trois attributs ci-dessus sont décrits dans POSIX.1b (anciennement POSIX.4)
et SUSv2. Linux propose également des attributs non standards :
<DL COMPACT>
<DT><B>MAP_DENYWRITE</B>

<DD>
Cet attribut est ignoré.
(Autrefois, une tentative d'écriture dans le fichier sous-jacent échouait avec
l'erreur ETXTBUSY. Mais ceci permettait des attaques de déni de service).
<DT><B>MAP_EXECUTABLE</B>

<DD>
Cet attribut est ignoré.
<DT><B>MAP_NORESERVE</B>

<DD>
(Utilisé conjointement à MAP_PRIVATE). Ne pas réserver d'espace de swap pour
les pages de cette projection. Une telle réservation garantit que l'on puisse
modifier les zones soumises à une copie-en-écriture. Sans réservation, on peut
recevoir un signal SIGSEGV durant une écriture, s'il n'y a plus de place
disponible.
<DT><B>MAP_LOCKED</B>

<DD>
(Depuis Linux 2.5.37) Verrouille la page projetée en mémoire à la manière de
<B>mlock()</B>.

Cet attribut est ignoré sur les noyaux plus anciens.
<DT><B>MAP_GROWSDOWN</B>

<DD>
Utilisé pour les piles. Indique au système de gestion de la mémoire virtuelle
que la projection doit s'étendre en croissant vers le bas de la mémoire.
<DT><B>MAP_ANONYMOUS</B>

<DD>
La projection n'est supportée par aucun fichier. Les arguments
<I>fd</I>

et
<I>offset</I>

sont ignorés. Cet attributs, utilisé en conjonction de MAP_SHARE
est implémenté depuis Linux 2.4.
<DT><B>MAP_ANON</B>

<DD>
Alias de MAP_ANONYMOUS. Déconseillé.
<DT><B>MAP_FILE</B>

<DD>
Attribut pour compatibilité. Ignoré.
<DT><B>MAP_32BIT</B>

<DD>
Faire la projection dans les premiers 2Go de l'espace d'adressage du processus.
Ignoré si
<I>MAP_FIXED</I>

est présent. Cet attribut n'est supporté que sur x86-64 pour les programmes 64-bits.
</DL>
<P>

Certains systèmes utilisent les attributs supplémentaires MAP_AUTOGROW,
MAP_AUTORESRV, MAP_COPY, and MAP_LOCAL.
<P>

<I>fd</I>

doit être un descripteur de fichier valide, sauf si on utilise MAP_ANONYMOUS,
auquel cas cet argument est ignoré.
<P>

L'argument
<I>offset</I>

doit normalement être un multiple de la taille de page renvoyée par l'appel
<B><A HREF="/cgi-bin/man/man2html?2+getpagesize">getpagesize</A></B>(2).

<P>

La mémoire obtenue par
<B>mmap</B>

est préservée lors d'un
<B><A HREF="/cgi-bin/man/man2html?2+fork">fork</A></B>(2),

avec les même attributs.
<P>

La projection doit avoir une taille multiple de celle des pages. Pour un fichier
dont la longueur n'est pas un multiple de la taille de page, la mémoire restante
est remplie de zéros lors de la projection, et les écritures dans cette zone
n'affectent pas le fichier. Les effets de la modification de la taille du fichier sous-jacent
sur les pages correspondant aux zones ajoutées ou supprimées ne sont pas précisés.
L'appel-système
<B>munmap</B>

détruit la projection dans la zone de mémoire spécifiée, et s'arrange pour
que toute référence ultérieure à cette zone mémoire déclenche une
erreur d'adressage. La projection est aussi automatiquement détruite lorsque
le processus se termine. À l'inverse, la fermeture du descripteur de fichier
ne supprime pas la projection.
<P>

L'adresse
<I>start</I>

doit être un multiple de la taille de page. Tous les pages contenant une partie
de l'intervalle indiquées sont libérées, et tout accès ultérieur
déclenchera SIGSEGV. Aucune erreur n'est détectée si l'intervalle
indiqué ne contient pas de page projetée.
<BR>&nbsp;
Pour les projections supportées par un fichier, le champ
<B>st_atime</B>

du fichier peut être mis à jour à tout moment entre l'appel
<B>mmap()</B>

et le munmap() correspondant. Le premier accès dans la page projetée
mettra le champ à jour si ce n'a pas été déjà fait.
<P>

Les champs
<B>st_ctime</B>

et
<B>st_mtime</B>

pour un fichier projeté avec PROT_WRITE et MAP_SHARED seront mis à jour après
une écriture dans la région projetée, et avant l'éventuel
<I>msync()</I>

suivant avec attribut MS_SYNC ou MS_ASYNC.
<A NAME="lbAE">&nbsp;</A>
<H2>VALEUR RENVOYÉE</H2>

<B>mmap</B>

renvoie un pointeur sur la zone de mémoire, s'il réussit. En
cas d'échec il retourne MAP_FAILED (-1) et 
<I>errno</I>

contient le code d'erreur.
<P>
<B>munmap</B>

renvoie 0 s'il réussit. En cas d'échec -1 est renvoyé et
<I>errno</I>

contient le code d'erreur (probablement EINVAL).
<A NAME="lbAF">&nbsp;</A>
<H2>NOTES</H2>

Suivant l'architecture
<I>PROT_READ</I>

peut include
<I>PROT_EXEC</I>

ou non. Les programmes portables doivent toujours indiquer
<I>PROT_EXEC</I>

s'ils veulent exécuter du code dans la projection.
<P>
<A NAME="lbAG">&nbsp;</A>
<H2>ERREURS</H2>

<DL COMPACT>
<DT><B>EBADF</B>

<DD>
<I>fd</I>

n'est pas un descripteur de fichier valide (et MAP_ANONYMOUS n'était pas précisé).
<DT><B>EACCES</B>

<DD>
Le descripteur ne correspond pas à un fichier normal, ou
on demande une projection privée MAP_PRIVATE mais
<I>fd</I>

n'est pas ouvert en lecture, ou on demande une projection
partagée MAP_SHARED avec protection PROT_WRITE, mais
<I>fd</I>

n'est pas ouvert en lecture et écriture (O_RDWR).
Ou encore PROT_WRITE est demandé, mais le fichier est ouvert en ajout seulement.
<DT><B>EINVAL</B>

<DD>
<I>start</I>

ou
<I>length</I>

ou
<I>offset</I>

sont invalides.
(par exemple : zone trop grande, ou non alignée sur une frontière de page).
<DT><B>ETXTBSY</B>

<DD>
MAP_DENYWRITE a été réclamé mais
<I>fd</I>

est ouvert en écriture
<DT><B>EAGAIN</B>

<DD>
Le fichier est verrouillé, ou trop de pages ont été verrouillées en mémoire.
<DT><B>ENOMEM</B>

<DD>
pas assez de mémoire, ou le nombre maximal de projection par processus a été
dépassé.
<DT><B>ENODEV</B>

<DD>
Le système de fichiers sous-jacent ne supporte pas la projection en mémoire.
</DL>
<P>

L'accès à une zone de projection peut déclencher les signaux suivants :
<DL COMPACT>
<DT><B>SIGSEGV</B>

<DD>
Tentative d'écriture dans une zone en lecture seule
<DT><B>SIGBUS</B>

<DD>
Tentative d'accès à une portion de la zone qui ne correspond pas au fichier
(par exemple après la fin du fichier, y compris lorsqu'un autre fichier l'a
<BR>&nbsp;tronqué).
</DL>
<A NAME="lbAH">&nbsp;</A>
<H2>CONFORMITÉ</H2>

SVr4, POSIX.1b (anciennement POSIX.4), BSD 4.4, SUSv2.
SVr4 documente les codes d'erreur supplémentaires ENXIO et ENODEV.
SUSv2 documente les codes d'erreur supplémentaires EMFILE et EOVERFLOW.
<P>
<I>MAP_32BIT</I>

est une extension Linux.
<A NAME="lbAI">&nbsp;</A>
<H2>VOIR AUSSI</H2>

<B><A HREF="/cgi-bin/man/man2html?2+getpagesize">getpagesize</A></B>(2),

<B><A HREF="/cgi-bin/man/man2html?2+mlock">mlock</A></B>(2),

<B><A HREF="/cgi-bin/man/man2html?2+mmap2">mmap2</A></B>(2),

<B><A HREF="/cgi-bin/man/man2html?2+mremap">mremap</A></B>(2),

<B><A HREF="/cgi-bin/man/man2html?2+msync">msync</A></B>(2),

<B><A HREF="/cgi-bin/man/man2html?2+shm_open">shm_open</A></B>(2),

B.O. Gallmeister, POSIX.4, O'Reilly, pp. 119-124 et 365-369.
<P>
<A NAME="lbAJ">&nbsp;</A>
<H2>TRADUCTION</H2>

Christophe Blaess, 1996-2003.
<P>

<HR>
<A NAME="index">&nbsp;</A><H2>Index</H2>
<DL>
<DT><A HREF="#lbAB">NOM</A><DD>
<DT><A HREF="#lbAC">SYNOPSIS</A><DD>
<DT><A HREF="#lbAD">DESCRIPTION</A><DD>
<DT><A HREF="#lbAE">VALEUR RENVOYÉE</A><DD>
<DT><A HREF="#lbAF">NOTES</A><DD>
<DT><A HREF="#lbAG">ERREURS</A><DD>
<DT><A HREF="#lbAH">CONFORMITÉ</A><DD>
<DT><A HREF="#lbAI">VOIR AUSSI</A><DD>
<DT><A HREF="#lbAJ">TRADUCTION</A><DD>
</DL>
<HR>
This document was created by
<A HREF="/cgi-bin/man/man2html">man2html</A>,
using the manual pages.<BR>
Time: 14:54:59 GMT, February 11, 2014
</BODY>
</HTML>
